exports.id=449,exports.ids=[449],exports.modules={4780:(e,t,r)=>{"use strict";r.d(t,{cn:()=>s});var a=r(49384),o=r(82348);function s(...e){return(0,o.QP)((0,a.$)(e))}},14947:(e,t,r)=>{"use strict";r.d(t,{Toaster:()=>b});var a=r(60687),o=r(29867),s=r(43210),n=r(47313),i=r(24224),l=r(78726),d=r(4780);let c=n.Kq,u=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)(n.LM,{ref:r,className:(0,d.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));u.displayName=n.LM.displayName;let m=(0,i.F)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),p=s.forwardRef(({className:e,variant:t,...r},o)=>(0,a.jsx)(n.bL,{ref:o,className:(0,d.cn)(m({variant:t}),e),...r}));p.displayName=n.bL.displayName,s.forwardRef(({className:e,...t},r)=>(0,a.jsx)(n.rc,{ref:r,className:(0,d.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t})).displayName=n.rc.displayName;let h=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)(n.bm,{ref:r,className:(0,d.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:(0,a.jsx)(l.A,{className:"h-4 w-4"})}));h.displayName=n.bm.displayName;let f=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)(n.hE,{ref:r,className:(0,d.cn)("text-sm font-semibold",e),...t}));f.displayName=n.hE.displayName;let v=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)(n.VY,{ref:r,className:(0,d.cn)("text-sm opacity-90",e),...t}));function b(){let{toasts:e}=(0,o.dj)();return(0,a.jsxs)(c,{children:[e.map(function({id:e,title:t,description:r,action:o,...s}){return(0,a.jsxs)(p,{...s,children:[(0,a.jsxs)("div",{className:"grid gap-1",children:[t&&(0,a.jsx)(f,{children:t}),r&&(0,a.jsx)(v,{children:r})]}),o,(0,a.jsx)(h,{})]},e)}),(0,a.jsx)(u,{})]})}v.displayName=n.VY.displayName},15256:(e,t,r)=>{"use strict";r.d(t,{ID:()=>i,a3:()=>n});var a=r(91243),o=r(58261),s=r(52291);let n=e=>{if(e<=0)return"0m";let t=Math.floor(e/1e3),r=Math.floor(t/3600),a=Math.floor(t%3600/60),o="";return r>0&&(o+=`${r}h `),(o+=`${a}m`).trim()||"0m"},i=(e,t,r=[])=>{let n=(0,a.P)(new Date(e,t)),i=0,l=r.map(e=>(0,o.H)(e instanceof Date?e.toISOString():e).setHours(0,0,0,0));for(let r=1;r<=n;r++){let a=new Date(e,t,r);if(0!==(0,s.P)(a)){let e=a.setHours(0,0,0,0);!l.includes(e)&&i++}}return i}},18864:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,86346,23)),Promise.resolve().then(r.t.bind(r,27924,23)),Promise.resolve().then(r.t.bind(r,35656,23)),Promise.resolve().then(r.t.bind(r,40099,23)),Promise.resolve().then(r.t.bind(r,38243,23)),Promise.resolve().then(r.t.bind(r,28827,23)),Promise.resolve().then(r.t.bind(r,62763,23)),Promise.resolve().then(r.t.bind(r,97173,23))},24738:(e,t,r)=>{Promise.resolve().then(r.bind(r,14947)),Promise.resolve().then(r.bind(r,31656))},29867:(e,t,r)=>{"use strict";r.d(t,{dj:()=>m});var a=r(43210);let o=0,s=new Map,n=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],d={toasts:[]};function c(e){d=i(d,e),l.forEach(e=>{e(d)})}function u({...e}){let t=(o=(o+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:t});return c({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function m(){let[e,t]=a.useState(d);return a.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},31656:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>y,c:()=>g});var a=r(60687),o=r(43210),s=r(7828),n=r(75535),i=r(44421),l=r(15256),d=r(45481),c=r(58261),u=r(13091),m=r(42102),p=r(46127),h=r(51023),f=r(16560),v=r(35843);let b=e=>{if(!e)return null;if(e instanceof n.Dc)return e.toDate();if(e instanceof Date)return e;try{let t=(0,c.H)(e);if(isNaN(t.getTime()))return null;return t}catch(t){return console.warn("Could not parse date string:",e,t),null}},g=(0,o.createContext)(void 0),y=({children:e})=>{let[t,r]=(0,o.useState)(null),[c,y]=(0,o.useState)(null),[x,I]=(0,o.useState)(null),[w,S]=(0,o.useState)(!0),[P,k]=(0,o.useState)(null),[C,D]=(0,o.useState)([]),[T,E]=(0,o.useState)([]),[A,M]=(0,o.useState)([]),[O,N]=(0,o.useState)([]),{auth:j,db:H}=(0,o.useMemo)(()=>{try{return(0,i.O)()}catch(e){return console.error("Failed to initialize Firebase",e),{auth:null,db:null}}},[]);(0,o.useEffect)(()=>{if(!j||!H){S(!1);return}let e=(0,s.hg)(j,async e=>{if(S(!0),e){let t=(0,n.H9)(H,"users",e.uid),a=await (0,n.x7)(t);if(a.exists()){let e={id:a.id,...a.data()};r(e),y(e.role),I(e.companyId)}else await (0,s.CI)(j),r(null),y(null),I(null)}else r(null),y(null),I(null);S(!1)});return()=>e()},[j,H]),(0,o.useEffect)(()=>{let e,r;if(!H||!t||!x){D([]),E([]),M([]),N([]),k(null);return}let a=[],o=(0,n.H9)(H,"companies",x);a.push((0,n.aQ)(o,e=>{k(e.exists()?e.data():null)})),e="admin"===t.role||"manager"===t.role?(0,n.P)((0,n.rJ)(H,`companies/${x}/tasks`)):(0,n.P)((0,n.rJ)(H,`companies/${x}/tasks`),(0,n._M)("assigneeId","==",t.employeeId)),a.push((0,n.aQ)(e,e=>{E(e.docs.map(e=>({...e.data(),id:e.id})))})),r="admin"===t.role||"manager"===t.role?(0,n.P)((0,n.rJ)(H,`companies/${x}/attendanceLog`)):(0,n.P)((0,n.rJ)(H,`companies/${x}/attendanceLog`),(0,n._M)("userId","==",t.id)),a.push((0,n.aQ)(r,e=>{M(e.docs.map(e=>{let t=e.data(),r=t.timestamp,a=r instanceof n.Dc?r.toDate().toISOString():r?new Date(r).toISOString():new Date().toISOString();return{...t,id:e.id,timestamp:a,checkInTime:t.checkInTime?t.checkInTime instanceof n.Dc?t.checkInTime.toDate().toISOString():t.checkInTime:void 0,checkOutTime:t.checkOutTime?t.checkOutTime instanceof n.Dc?t.checkOutTime.toDate().toISOString():t.checkOutTime:void 0,totalHours:t.totalHours}}))}));let s=(0,n.P)((0,n.rJ)(H,`companies/${x}/announcements`));if(a.push((0,n.aQ)(s,e=>{N(e.docs.map(e=>{let t=e.data(),r=t.postedAt,a=r instanceof n.Dc?r.toDate().toISOString():r?new Date(r).toISOString():new Date().toISOString();return{...t,id:e.id,postedAt:a}}))})),"admin"===t.role){let e=(0,n.P)((0,n.rJ)(H,"users"),(0,n._M)("companyId","==",x));a.push((0,n.aQ)(e,e=>{D(e.docs.map(e=>({id:e.id,...e.data()})))}))}else D(t?[t]:[]);return()=>{a.forEach(e=>e())}},[H,t,x]);let _=(0,o.useCallback)(async(e,t)=>{if(!j||!H)throw Error("Authentication service not ready.");let r=(0,n.P)((0,n.rJ)(H,"userDirectory"),(0,n._M)("employeeId","==",e)),a=await (0,n.GG)(r);if(a.empty)throw Error("Invalid User ID or Password.");let o=a.docs[0].data().email;if(!o)throw Error("User configuration error. Please contact support.");return await (0,s.x9)(j,o,t),null},[j,H]),R=(0,o.useCallback)(async()=>{j&&await (0,s.CI)(j)},[j]),$=(0,o.useCallback)(async(e,t)=>{if(!j||!H)throw Error("Firebase services not ready.");if(!t)throw Error("Password is required for new accounts.");let r=e.email||`${e.employeeId.toLowerCase().replace(/[^a-z0-9]/gi,"")}@${e.companyId.split("-")[0]}.karobhr.local`,a=(await (0,s.eJ)(j,r,t)).user,o={id:a.uid,...e},i=(0,n.wP)(H);i.set((0,n.H9)(H,`users/${a.uid}`),o),i.set((0,n.H9)(H,`userDirectory/${a.uid}`),{userId:a.uid,employeeId:o.employeeId,email:r,companyId:o.companyId,name:o.name,role:o.role});let l=(0,n.H9)(H,"companies",o.companyId);return(await (0,n.x7)(l)).exists()||"admin"!==o.role||i.set(l,{companyId:o.companyId,companyName:e.companyName||"My Company",adminUid:a.uid,createdAt:(0,n.O5)(),salaryCalculationMethod:"standard_hours",officeLocation:{name:"Main Office",latitude:0,longitude:0,radius:100}}),await i.commit(),a},[j,H]),L=(0,o.useCallback)(async e=>{if(!H||!x)throw console.error("Update failed: DbInstance or CompanyId not available."),Error("User is not properly authenticated or company context is missing.");let t=(0,n.H9)(H,"companies",x);await (0,n.mZ)(t,e)},[H,x]),U=(0,o.useCallback)(async e=>{if(!H||!x)throw Error("User or company context not available.");await (0,n.gS)((0,n.rJ)(H,`companies/${x}/tasks`),{...e,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)()})},[H,x]),J=(0,o.useCallback)(async e=>{if(!H||!x)throw Error("Database or company context not available.");let{id:t,...r}=e;await (0,n.mZ)((0,n.H9)(H,`companies/${x}/tasks/${t}`),{...r,updatedAt:(0,n.O5)()})},[H,x]),W=(0,o.useCallback)(async e=>{if(!H||!t||!x||!P?.officeLocation)throw Error("Context not available");let{officeLocation:r}=P,a=(0,d.g)(e.latitude,e.longitude,r.latitude,r.longitude)<=r.radius,o={employeeId:t.employeeId,userId:t.id,userName:t.name||"",type:"check-in",timestamp:(0,n.O5)(),checkInLocation:e,isWithinGeofence:a,status:"Checked In"};return(await (0,n.gS)((0,n.rJ)(H,`companies/${x}/attendanceLog`),o)).id},[H,t,x,P]),F=(0,o.useCallback)(async(e,r,a)=>{if(!H||!t||!x)throw Error("Context not available");let o=(0,n.H9)(H,`companies/${x}/attendanceLog`,e),s=await (0,n.x7)(o);if(!s.exists())throw Error("Could not find the original check-in document to update.");let i=b(s.data().timestamp);if(!i)throw Error("Could not parse check-in time for duration calculation.");let l=new Date,d=(0,u.b)(l,i)/36e5;await (0,n.mZ)(o,{status:"Checked Out",type:"check-out",checkOutTime:n.Dc.fromDate(l),checkOutLocation:a,workReport:r,totalHours:d})},[H,t,x]),Q=(0,o.useCallback)((e,t,r,a,o=[])=>{if(!e||!e.baseSalary||!e.standardDailyHours)throw Error("Employee data for payroll calculation is incomplete.");let{baseSalary:s,standardDailyHours:n}=e,i=new Date(t,r),d=(0,l.ID)(t,r,o.map(e=>e.date)),c=d*n,u={start:(0,m.w)(i),end:(0,p.p)(i)},g=a.reduce((e,t)=>{if("Checked Out"===t.status&&void 0!==t.totalHours&&null!==t.totalHours){let r=b(t.timestamp);if(r&&(0,h.v)(r,u))return e+t.totalHours}return e},0),y=Math.max(0,c-g),x=s/c,I=y*x,w=s-I,S=e.advances?.filter(e=>"approved"===e.status&&f.C(b(e.dateProcessed))===t&&v.t(b(e.dateProcessed))===r).reduce((e,t)=>e+t.amount,0)??0;return{employeeId:e.employeeId,employeeName:e.name||"N/A",month:r,year:t,baseSalary:s,standardDailyHours:n,totalWorkingDaysInMonth:d,totalStandardHoursForMonth:c,totalActualHoursWorked:g,totalHoursMissed:y,hourlyRate:x,calculatedDeductions:I,salaryAfterDeductions:w,totalApprovedAdvances:S,finalNetPayable:w-S}},[]),V=(0,o.useMemo)(()=>({user:t,role:c,loading:w,companyId:x,companySettings:P,allUsers:C,tasks:T,attendanceLog:A,announcements:O,login:_,logout:R,addNewEmployee:$,updateCompanySettings:L,addTask:U,updateTask:J,addAttendanceEvent:W,completeCheckout:F,calculateMonthlyPayrollDetails:Q}),[t,c,w,x,P,C,T,A,O,_,R,$,L,U,J,W,F,Q]);return(0,a.jsx)(g.Provider,{value:V,children:e})}},44421:(e,t,r)=>{"use strict";r.d(t,{O:()=>d});var a=r(67989),o=r(7828),s=r(75535),n=r(70146);let i={projectId:"karobhr-app",appId:"1:173193434755:web:ade88ec8193ca04dff2db6",storageBucket:"karobhr-app.firebasestorage.app",apiKey:"AIzaSyCP67K069RaS0kRF_2RrwkyMkit6KpYtVU",authDomain:"karobhr-app.firebaseapp.com",messagingSenderId:"173193434755",measurementId:"G-YDWNN7RCWP"},l=(0,a.Dk)().length?(0,a.Sx)():(0,a.Wp)(i);function d(){return function(){let e=(0,a.Dk)().length>0,t=e?(0,a.Sx)():(0,a.Wp)(i),r=(0,o.xI)(t),l=(0,s.aU)(t),d=(0,n.c7)(t);return"true"!==process.env.NEXT_PUBLIC_USE_EMULATORS||(r.emulatorConfig||(console.log("Connecting to Firebase Auth Emulator"),(0,o.Wq)(r,"http://127.0.0.1:9099",{disableWarnings:!0})),l._settings.host.startsWith("127.0.0.1")||(console.log("Connecting to Firebase Firestore Emulator"),(0,s.vN)(l,"127.0.0.1",8080))),{firebaseApp:t,auth:r,db:l,storage:d,isConfigured:e}}()}(0,s.aU)(l),(0,o.xI)(l),(0,n.c7)(l)},45481:(e,t,r)=>{"use strict";function a(e,t,r,a){let o=e*Math.PI/180,s=r*Math.PI/180,n=(r-e)*Math.PI/180,i=(a-t)*Math.PI/180,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(o)*Math.cos(s)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3}r.d(t,{g:()=>a})},51454:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>o});var a=r(12907);(0,a.registerClientReference)(function(){throw Error("Attempted to call AuthContext() from the server but AuthContext is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/lib/authContext.tsx","AuthContext");let o=(0,a.registerClientReference)(function(){throw Error("Attempted to call AuthProvider() from the server but AuthProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/lib/authContext.tsx","AuthProvider")},56282:(e,t,r)=>{Promise.resolve().then(r.bind(r,79737)),Promise.resolve().then(r.bind(r,51454))},60720:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,16444,23)),Promise.resolve().then(r.t.bind(r,16042,23)),Promise.resolve().then(r.t.bind(r,88170,23)),Promise.resolve().then(r.t.bind(r,49477,23)),Promise.resolve().then(r.t.bind(r,29345,23)),Promise.resolve().then(r.t.bind(r,12089,23)),Promise.resolve().then(r.t.bind(r,46577,23)),Promise.resolve().then(r.t.bind(r,31307,23))},61135:()=>{},79737:(e,t,r)=>{"use strict";r.d(t,{Toaster:()=>a});let a=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call Toaster() from the server but Toaster is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/components/ui/toaster.tsx","Toaster")},94431:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m,metadata:()=>c,viewport:()=>u});var a=r(37413),o=r(2202),s=r.n(o),n=r(64988),i=r.n(n);r(61135);var l=r(51454),d=r(79737);let c={title:"KarobHR - Employee Management System",description:"Comprehensive Employee Attendance, Payroll, Leave, and Task Management.",manifest:"/manifest.json"},u={themeColor:"#6D28D9"};function m({children:e}){return(0,a.jsx)("html",{lang:"en",suppressHydrationWarning:!0,children:(0,a.jsx)("body",{className:`${s().variable} ${i().variable} antialiased`,children:(0,a.jsxs)(l.AuthProvider,{children:[e,(0,a.jsx)(d.Toaster,{})]})})})}}};