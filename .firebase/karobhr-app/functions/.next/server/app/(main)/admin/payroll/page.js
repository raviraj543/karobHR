(()=>{var e={};e.id=401,e.ids=[401],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3662:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(82614).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6211:(e,r,t)=>{"use strict";t.d(r,{A0:()=>l,BF:()=>i,Hj:()=>o,XI:()=>d,nA:()=>m,nd:()=>c});var s=t(60687),a=t(43210),n=t(4780);let d=a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,n.cn)("w-full caption-bottom text-sm",e),...r})}));d.displayName="Table";let l=a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("thead",{ref:t,className:(0,n.cn)("[&_tr]:border-b",e),...r}));l.displayName="TableHeader";let i=a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("tbody",{ref:t,className:(0,n.cn)("[&_tr:last-child]:border-0",e),...r}));i.displayName="TableBody",a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("tfoot",{ref:t,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...r})).displayName="TableFooter";let o=a.forwardRef(({className:e,...r},t)=>{let{key:a,...d}=r;return(0,s.jsx)("tr",{ref:t,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...d})});o.displayName="TableRow";let c=a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("th",{ref:t,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...r}));c.displayName="TableHead";let m=a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("td",{ref:t,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...r}));m.displayName="TableCell",a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("caption",{ref:t,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",e),...r})).displayName="TableCaption"},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11516:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(82614).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},13861:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/user/studio/src/app/(main)/admin/payroll/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/app/(main)/admin/payroll/page.tsx","default")},14975:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(82614).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},34791:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>v});var s=t(60687),a=t(43210),n=t(87979),d=t(29523),l=t(44493),i=t(6211),o=t(29867),c=t(11516),m=t(9023),p=t(79277),u=t(66421),x=t(14975),h=t(3662),f=t(97025),j=t(35843),y=t(16560);function v(){let{allUsers:e,processAdvance:r,loading:t,attendanceLog:v,calculateMonthlyPayrollDetails:g}=(0,n.A)(),[N,b]=(0,a.useState)(!1),{toast:A}=(0,o.dj)(),[w,k]=(0,a.useState)([]),[q,C]=(0,a.useState)(!0),P=(0,j.t)(new Date),R=(0,y.C)(new Date),M=(0,a.useMemo)(()=>t?[]:e.flatMap(e=>(e.advances||[]).filter(e=>"pending"===e.status).map(r=>({...r,userName:e.name||e.employeeId,userUid:e.id}))),[e,t]),S=async(t,s,a)=>{b(!0);try{if(await r(t,s,a),A({title:`Advance ${a}`,description:`The advance request has been ${a}. Payroll data will refresh.`}),g&&v){let r=e.filter(e=>"admin"!==e.role).map(e=>{let r=v.filter(r=>r.employeeId===e.employeeId);return g(e,R,P,r,[])});k(r)}}catch(e){console.error("Error processing advance:",e),A({title:"Error Processing Advance",description:e.message||"Could not process the advance request.",variant:"destructive"})}finally{b(!1)}};return t||q?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full py-10 space-y-2",children:[(0,s.jsx)(c.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:t?"Loading user data...":"Calculating payroll for current month..."})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-foreground",children:"Payroll Management"}),(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Oversee employee salaries for the current month (",new Date(R,P).toLocaleString("default",{month:"long",year:"numeric"}),") and process advance requests."]})]})}),(0,s.jsxs)(l.Zp,{className:"shadow-sm",children:[(0,s.jsxs)(l.aR,{children:[(0,s.jsxs)(l.ZB,{className:"flex items-center",children:[(0,s.jsx)(m.A,{className:"mr-2 h-5 w-5 text-primary"}),"Employee Salary Overview (Current Month)"]}),(0,s.jsxs)(l.BT,{children:["Summary of employee salaries, including deductions for missed hours and approved advances.",(0,s.jsxs)("span",{className:"block text-xs text-muted-foreground/80 italic mt-1",children:["Calculations based on attendance data for ",new Date(R,P).toLocaleString("default",{month:"long",year:"numeric"}),". Sundays are excluded from standard work hours."]})]})]}),(0,s.jsx)(l.Wu,{children:(0,s.jsxs)(i.XI,{children:[(0,s.jsx)(i.A0,{children:(0,s.jsxs)(i.Hj,{children:[(0,s.jsx)(i.nd,{children:"Employee Name"}),(0,s.jsxs)(i.nd,{children:[(0,s.jsx)(p.A,{className:"inline-block mr-1 h-4 w-4"}),"ID"]}),(0,s.jsx)(i.nd,{children:"Base Salary"}),(0,s.jsxs)(i.nd,{children:[(0,s.jsx)(u.A,{className:"inline-block mr-1 h-3 w-3"}),"Std. Hours (Month)"]}),(0,s.jsxs)(i.nd,{children:[(0,s.jsx)(u.A,{className:"inline-block mr-1 h-3 w-3"}),"Actual Hours (Month)"]}),(0,s.jsx)(i.nd,{children:"Deductions"}),(0,s.jsx)(i.nd,{children:"Advances"}),(0,s.jsx)(i.nd,{children:"Net Payable"})]})}),(0,s.jsx)(i.BF,{children:w.length>0?w.map(e=>(0,s.jsxs)(i.Hj,{children:[(0,s.jsx)(i.nA,{className:"font-medium",children:e.employeeName}),(0,s.jsx)(i.nA,{className:"font-mono text-xs",children:e.employeeId}),(0,s.jsxs)(i.nA,{children:["₹",e.baseSalary.toLocaleString("en-IN")]}),(0,s.jsxs)(i.nA,{children:[e.totalStandardHoursForMonth.toFixed(1),"h"]}),(0,s.jsxs)(i.nA,{className:e.totalActualHoursWorked<e.totalStandardHoursForMonth?"text-orange-600":"text-green-600",children:[e.totalActualHoursWorked.toFixed(1),"h"]}),(0,s.jsxs)(i.nA,{className:e.calculatedDeductions>0?"text-destructive":"",children:["₹",e.calculatedDeductions.toLocaleString("en-IN")]}),(0,s.jsxs)(i.nA,{className:"text-red-600",children:["(₹",e.totalApprovedAdvances.toLocaleString("en-IN"),")"]}),(0,s.jsxs)(i.nA,{className:"font-semibold",children:["₹",e.finalNetPayable.toLocaleString("en-IN")]})]},e.employeeId)):(0,s.jsx)(i.Hj,{children:(0,s.jsx)(i.nA,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"No employee data available to calculate payroll."})})})]})})]}),(0,s.jsxs)(l.Zp,{className:"shadow-sm",children:[(0,s.jsxs)(l.aR,{children:[(0,s.jsxs)(l.ZB,{className:"flex items-center",children:[(0,s.jsx)(x.A,{className:"mr-2 h-5 w-5 text-primary"}),"Pending Advance Requests"]}),(0,s.jsx)(l.BT,{children:"Review and process outstanding advance requests from employees."})]}),(0,s.jsx)(l.Wu,{children:M.length>0?(0,s.jsxs)(i.XI,{children:[(0,s.jsx)(i.A0,{children:(0,s.jsxs)(i.Hj,{children:[(0,s.jsx)(i.nd,{children:"Employee Name"}),(0,s.jsx)(i.nd,{children:"Amount"}),(0,s.jsx)(i.nd,{children:"Reason"}),(0,s.jsx)(i.nd,{children:"Date Requested"}),(0,s.jsx)(i.nd,{children:"Actions"})]})}),(0,s.jsx)(i.BF,{children:M.map(e=>(0,s.jsxs)(i.Hj,{children:[(0,s.jsx)(i.nA,{className:"font-medium",children:e.userName}),(0,s.jsxs)(i.nA,{children:["₹",e.amount.toLocaleString("en-IN")]}),(0,s.jsx)(i.nA,{className:"text-sm text-muted-foreground",children:e.reason}),(0,s.jsx)(i.nA,{children:new Date(e.dateRequested).toLocaleDateString()}),(0,s.jsxs)(i.nA,{className:"space-x-2",children:[(0,s.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>S(e.userUid,e.id,"approved"),disabled:N,className:"text-green-600 border-green-600 hover:bg-green-50 hover:text-green-700",children:[N&&(0,s.jsx)(c.A,{className:"mr-1 h-3 w-3 animate-spin"}),(0,s.jsx)(h.A,{className:"mr-1 h-4 w-4"})," Approve"]}),(0,s.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>S(e.userUid,e.id,"rejected"),disabled:N,className:"text-red-600 border-red-600 hover:bg-red-50 hover:text-red-700",children:[N&&(0,s.jsx)(c.A,{className:"mr-1 h-3 w-3 animate-spin"}),(0,s.jsx)(f.A,{className:"mr-1 h-4 w-4"})," Reject"]})]})]},e.id))})]}):(0,s.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No pending advance requests."})})]})]})}},37366:e=>{"use strict";e.exports=require("dns")},44493:(e,r,t)=>{"use strict";t.d(r,{BT:()=>o,Wu:()=>c,ZB:()=>i,Zp:()=>d,aR:()=>l});var s=t(60687),a=t(43210),n=t(4780);let d=a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...r}));d.displayName="Card";let l=a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...r}));l.displayName="CardHeader";let i=a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",e),...r}));i.displayName="CardTitle";let o=a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",e),...r}));o.displayName="CardDescription";let c=a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",e),...r}));c.displayName="CardContent",a.forwardRef(({className:e,...r},t)=>(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",e),...r})).displayName="CardFooter"},46452:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>d.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>o});var s=t(65239),a=t(48088),n=t(88170),d=t.n(n),l=t(30893),i={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>l[e]);t.d(r,i);let o={children:["",{children:["(main)",{children:["admin",{children:["payroll",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,13861)),"/home/user/studio/src/app/(main)/admin/payroll/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,60448)),"/home/user/studio/src/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,94431)),"/home/user/studio/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/home/user/studio/src/app/(main)/admin/payroll/page.tsx"],m={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/(main)/admin/payroll/page",pathname:"/admin/payroll",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},55511:e=>{"use strict";e.exports=require("crypto")},60926:(e,r,t)=>{Promise.resolve().then(t.bind(t,34791))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65654:(e,r,t)=>{Promise.resolve().then(t.bind(t,13861))},66421:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(82614).A)("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]])},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},79277:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(82614).A)("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]])},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},97025:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(82614).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,178,658,814,595,449,208],()=>t(46452));module.exports=s})();