"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7275],{2846:(e,t,a)=>{a.d(t,{ID:()=>c,a3:()=>i});var o=a(5245),r=a(3343),n=a(9233);let i=e=>{if(e<=0)return"0m";let t=Math.floor(e/1e3),a=Math.floor(t/3600),o=Math.floor(t%3600/60),r="";return a>0&&(r+="".concat(a,"h ")),(r+="".concat(o,"m")).trim()||"0m"},c=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=(0,o.P)(new Date(e,t)),c=0,s=a.map(e=>(0,r.H)(e instanceof Date?e.toISOString():e).setHours(0,0,0,0));for(let a=1;a<=i;a++){let o=new Date(e,t,a);if(0!==(0,n.P)(o)){let e=o.setHours(0,0,0,0);!s.includes(e)&&c++}}return c}},4470:(e,t,a)=>{a.d(t,{O:()=>d});var o=a(3915),r=a(3004),n=a(5317),i=a(858);let c={projectId:"karobhr-app",appId:"1:173193434755:web:ade88ec8193ca04dff2db6",storageBucket:"karobhr-app.firebasestorage.app",apiKey:"AIzaSyCP67K069RaS0kRF_2RrwkyMkit6KpYtVU",authDomain:"karobhr-app.firebaseapp.com",messagingSenderId:"173193434755",measurementId:"G-YDWNN7RCWP"},s=(0,o.Dk)().length?(0,o.Sx)():(0,o.Wp)(c);(0,n.aU)(s),(0,r.xI)(s),(0,i.c7)(s);var l=a(9509);let u=null;function d(){return u||(u=function(){let e=(0,o.Dk)().length>0,t=e?(0,o.Sx)():(0,o.Wp)(c),a=(0,r.xI)(t),s=(0,n.aU)(t),u=(0,i.c7)(t);return"true"!==l.env.NEXT_PUBLIC_USE_EMULATORS||(a.emulatorConfig||(console.log("Connecting to Firebase Auth Emulator"),(0,r.Wq)(a,"http://127.0.0.1:9099",{disableWarnings:!0})),s._settings.host.startsWith("127.0.0.1")||(console.log("Connecting to Firebase Firestore Emulator"),(0,n.vN)(s,"127.0.0.1",8080))),{firebaseApp:t,auth:a,db:s,storage:u,isConfigured:e}}()),u}},6847:(e,t,a)=>{a.d(t,{g:()=>o});function o(e,t,a,o){let r=e*Math.PI/180,n=a*Math.PI/180,i=(a-e)*Math.PI/180,c=(o-t)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(r)*Math.cos(n)*Math.sin(c/2)*Math.sin(c/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3}},8232:(e,t,a)=>{a.d(t,{AuthProvider:()=>g,c:()=>k});var o=a(5155),r=a(2115),n=a(3004),i=a(5317),c=a(4470),s=a(2846),l=a(6847),u=a(3343),d=a(657),m=a(9164),p=a(4641),h=a(2873),f=a(908),I=a(8018);let y=e=>{if(!e)return null;if(e instanceof i.Dc)return e.toDate();if(e instanceof Date)return e;try{let t=(0,u.H)(e);if(isNaN(t.getTime()))return null;return t}catch(t){return console.warn("Could not parse date string:",e,t),null}},k=(0,r.createContext)(void 0),g=e=>{let{children:t}=e,[a,u]=(0,r.useState)(null),[g,w]=(0,r.useState)(null),[S,b]=(0,r.useState)(null),[D,v]=(0,r.useState)(!0),[C,M]=(0,r.useState)(null),[O,P]=(0,r.useState)([]),[E,x]=(0,r.useState)([]),[H,N]=(0,r.useState)([]),[T,_]=(0,r.useState)([]),{auth:A,db:U}=(0,r.useMemo)(()=>{try{return(0,c.O)()}catch(e){return console.error("Failed to initialize Firebase",e),{auth:null,db:null}}},[]);(0,r.useEffect)(()=>{if(!A||!U){v(!1);return}let e=(0,n.hg)(A,async e=>{if(v(!0),e){let t=(0,i.H9)(U,"users",e.uid),a=await (0,i.x7)(t);if(a.exists()){let e={id:a.id,...a.data()};u(e),w(e.role),b(e.companyId)}else await (0,n.CI)(A),u(null),w(null),b(null)}else u(null),w(null),b(null);v(!1)});return()=>e()},[A,U]),(0,r.useEffect)(()=>{let e,t;if(!U||!a||!S){P([]),x([]),N([]),_([]),M(null);return}let o=[],r=(0,i.H9)(U,"companies",S);o.push((0,i.aQ)(r,e=>{M(e.exists()?e.data():null)})),e="admin"===a.role||"manager"===a.role?(0,i.P)((0,i.rJ)(U,"companies/".concat(S,"/tasks"))):(0,i.P)((0,i.rJ)(U,"companies/".concat(S,"/tasks")),(0,i._M)("assigneeId","==",a.employeeId)),o.push((0,i.aQ)(e,e=>{x(e.docs.map(e=>({...e.data(),id:e.id})))})),t="admin"===a.role||"manager"===a.role?(0,i.P)((0,i.rJ)(U,"companies/".concat(S,"/attendanceLog"))):(0,i.P)((0,i.rJ)(U,"companies/".concat(S,"/attendanceLog")),(0,i._M)("userId","==",a.id)),o.push((0,i.aQ)(t,e=>{N(e.docs.map(e=>{let t=e.data(),a=t.timestamp,o=a instanceof i.Dc?a.toDate().toISOString():a?new Date(a).toISOString():new Date().toISOString();return{...t,id:e.id,timestamp:o,checkInTime:t.checkInTime?t.checkInTime instanceof i.Dc?t.checkInTime.toDate().toISOString():t.checkInTime:void 0,checkOutTime:t.checkOutTime?t.checkOutTime instanceof i.Dc?t.checkOutTime.toDate().toISOString():t.checkOutTime:void 0,totalHours:t.totalHours}}))}));let n=(0,i.P)((0,i.rJ)(U,"companies/".concat(S,"/announcements")));if(o.push((0,i.aQ)(n,e=>{_(e.docs.map(e=>{let t=e.data(),a=t.postedAt,o=a instanceof i.Dc?a.toDate().toISOString():a?new Date(a).toISOString():new Date().toISOString();return{...t,id:e.id,postedAt:o}}))})),"admin"===a.role){let e=(0,i.P)((0,i.rJ)(U,"users"),(0,i._M)("companyId","==",S));o.push((0,i.aQ)(e,e=>{P(e.docs.map(e=>({id:e.id,...e.data()})))}))}else P(a?[a]:[]);return()=>{o.forEach(e=>e())}},[U,a,S]);let L=(0,r.useCallback)(async(e,t)=>{if(!A||!U)throw Error("Authentication service not ready.");let a=(0,i.P)((0,i.rJ)(U,"userDirectory"),(0,i._M)("employeeId","==",e)),o=await (0,i.GG)(a);if(o.empty)throw Error("Invalid User ID or Password.");let r=o.docs[0].data().email;if(!r)throw Error("User configuration error. Please contact support.");return await (0,n.x9)(A,r,t),null},[A,U]),J=(0,r.useCallback)(async()=>{A&&await (0,n.CI)(A)},[A]),W=(0,r.useCallback)(async(e,t)=>{if(!A||!U)throw Error("Firebase services not ready.");if(!t)throw Error("Password is required for new accounts.");let a=e.email||"".concat(e.employeeId.toLowerCase().replace(/[^a-z0-9]/gi,""),"@").concat(e.companyId.split("-")[0],".karobhr.local"),o=(await (0,n.eJ)(A,a,t)).user,r={id:o.uid,...e},c=(0,i.wP)(U);c.set((0,i.H9)(U,"users/".concat(o.uid)),r),c.set((0,i.H9)(U,"userDirectory/".concat(o.uid)),{userId:o.uid,employeeId:r.employeeId,email:a,companyId:r.companyId,name:r.name,role:r.role});let s=(0,i.H9)(U,"companies",r.companyId);return(await (0,i.x7)(s)).exists()||"admin"!==r.role||c.set(s,{companyId:r.companyId,companyName:e.companyName||"My Company",adminUid:o.uid,createdAt:(0,i.O5)(),salaryCalculationMethod:"standard_hours",officeLocation:{name:"Main Office",latitude:0,longitude:0,radius:100}}),await c.commit(),o},[A,U]),F=(0,r.useCallback)(async e=>{if(!U||!S)throw console.error("Update failed: DbInstance or CompanyId not available."),Error("User is not properly authenticated or company context is missing.");let t=(0,i.H9)(U,"companies",S);await (0,i.mZ)(t,e)},[U,S]),Q=(0,r.useCallback)(async e=>{if(!U||!S)throw Error("User or company context not available.");await (0,i.gS)((0,i.rJ)(U,"companies/".concat(S,"/tasks")),{...e,createdAt:(0,i.O5)(),updatedAt:(0,i.O5)()})},[U,S]),R=(0,r.useCallback)(async e=>{if(!U||!S)throw Error("Database or company context not available.");let{id:t,...a}=e;await (0,i.mZ)((0,i.H9)(U,"companies/".concat(S,"/tasks/").concat(t)),{...a,updatedAt:(0,i.O5)()})},[U,S]),q=(0,r.useCallback)(async e=>{if(!U||!a||!S||!(null==C?void 0:C.officeLocation))throw Error("Context not available");let{officeLocation:t}=C,o=(0,l.g)(e.latitude,e.longitude,t.latitude,t.longitude)<=t.radius,r={employeeId:a.employeeId,userId:a.id,userName:a.name||"",type:"check-in",timestamp:(0,i.O5)(),checkInLocation:e,isWithinGeofence:o,status:"Checked In"};return(await (0,i.gS)((0,i.rJ)(U,"companies/".concat(S,"/attendanceLog")),r)).id},[U,a,S,C]),G=(0,r.useCallback)(async(e,t,o)=>{if(!U||!a||!S)throw Error("Context not available");let r=(0,i.H9)(U,"companies/".concat(S,"/attendanceLog"),e),n=await (0,i.x7)(r);if(!n.exists())throw Error("Could not find the original check-in document to update.");let c=y(n.data().timestamp);if(!c)throw Error("Could not parse check-in time for duration calculation.");let s=new Date,l=(0,d.b)(s,c)/36e5;await (0,i.mZ)(r,{status:"Checked Out",type:"check-out",checkOutTime:i.Dc.fromDate(s),checkOutLocation:o,workReport:t,totalHours:l})},[U,a,S]),z=(0,r.useCallback)(function(e,t,a,o){var r,n;let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(!e||!e.baseSalary||!e.standardDailyHours)throw Error("Employee data for payroll calculation is incomplete.");let{baseSalary:c,standardDailyHours:l}=e,u=new Date(t,a),d=(0,s.ID)(t,a,i.map(e=>e.date)),k=d*l,g={start:(0,m.w)(u),end:(0,p.p)(u)},w=o.reduce((e,t)=>{if("Checked Out"===t.status&&void 0!==t.totalHours&&null!==t.totalHours){let a=y(t.timestamp);if(a&&(0,h.v)(a,g))return e+t.totalHours}return e},0),S=Math.max(0,k-w),b=c/k,D=S*b,v=c-D,C=null!==(n=null===(r=e.advances)||void 0===r?void 0:r.filter(e=>"approved"===e.status&&(0,f.C)(y(e.dateProcessed))===t&&(0,I.t)(y(e.dateProcessed))===a).reduce((e,t)=>e+t.amount,0))&&void 0!==n?n:0;return{employeeId:e.employeeId,employeeName:e.name||"N/A",month:a,year:t,baseSalary:c,standardDailyHours:l,totalWorkingDaysInMonth:d,totalStandardHoursForMonth:k,totalActualHoursWorked:w,totalHoursMissed:S,hourlyRate:b,calculatedDeductions:D,salaryAfterDeductions:v,totalApprovedAdvances:C,finalNetPayable:v-C}},[]),K=(0,r.useMemo)(()=>({user:a,role:g,loading:D,companyId:S,companySettings:C,allUsers:O,tasks:E,attendanceLog:H,announcements:T,login:L,logout:J,addNewEmployee:W,updateCompanySettings:F,addTask:Q,updateTask:R,addAttendanceEvent:q,completeCheckout:G,calculateMonthlyPayrollDetails:z}),[a,g,D,S,C,O,E,H,T,L,J,W,F,Q,R,q,G,z]);return(0,o.jsx)(k.Provider,{value:K,children:t})}},9434:(e,t,a)=>{a.d(t,{cn:()=>n});var o=a(2596),r=a(9688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,o.$)(t))}}}]);